swagger: '2.0'
info:
  version: 0.0.1
  title:  Example Api
  description: ''
host: 'localhost:8080'
basePath: /example-api
tags:
  - name: Purchases
    description: 'Purchase a product'
paths:
  '/v1/purchase':
    post:
      operationId: purchaseProduct
      summary: 'Purchase a product'
      tags:
        - Purchases
      consumes:
        - application/json
      parameters:
        - name: body
          in: body
          schema:
            $ref: '#/definitions/purchase-save-request'
      responses:
        '200':
          description: ''
          schema:
            $ref: '#/definitions/response-base'
        '401':
          $ref: '#/responses/response-unauthorized'
        '500':
          $ref: '#/responses/response-internal-server-error-500'
  '/v1/purchases/{customer-id}':
      get:
        operationId: getAllTransactions
        summary: Get All transactions for a customer
        tags:
          - Purchases
        produces:
        - application/json
        parameters:
          - $ref: '#/parameters/customer-id-in-path'
        responses:
          '200':
            description: ''
            schema:
              $ref: '#/definitions/response-model-payment-transaction-list'
          '401':
            $ref: '#/responses/response-unauthorized'
          '500':
            $ref: '#/responses/response-internal-server-error-500'
  '/v1/purchases/{transaction-id}/refund':
      put:
        operationId: refundPayment
        summary: 'Refund payment'
        tags:
          - Purchases
        consumes:
        - application/json
        parameters:
          - $ref: '#/parameters/transaction-id-in-path'
        responses:
          '200':
            description: ''
            schema:
              $ref: '#/definitions/response-base'
          '401':
            $ref: '#/responses/response-unauthorized'
          '500':
            $ref: '#/responses/response-internal-server-error-500'
parameters:
  transaction-id-in-path:
    in: path
    name: transaction-id
    type: string
    required: true
  customer-id-in-path:
    in: path
    name: customer-id
    type: string
    required: true
definitions:
    response-base:
      type: object
      properties:
        success:
          type: boolean
        resultCode:
          type: integer
          format: int32
        message:
          type: string
        errors:
          type: array
          items:
            type: string
        transactionId:
          type: string
        type:
          type: string
      discriminator: type
      required:
        - success
        - resultCode
    model-enum-id-value:
      type: object
      properties:
        id: 
          type: integer
          format: int32
        value:
          type: string
      required:
         - id
    purchase-save-request:
      type: object
      properties:
        phoneNumber:
          type: string
        productId:
          type: string
        amount:
          type: number
          format: double
        currency:
          $ref: '#/definitions/model-enum-id-value'
      required: 
        - phoneNumber
        - productId
        - amount
        - currency
    model-payment-transaction:
      type: object
      properties:
        phoneNumber:
          type: string
        msisdn:
          type: string
        productId:
          type: string
        transactionId:
          description: A transaction-id generated internally
          type: string
        orderId:
          description: An order-id generated on succesful call to telecom API
          type: string
        amount:
          type: number
          format: double
        currency:
          $ref: '#/definitions/model-enum-id-value'
        kind:
          type: string
        refund_reason:
          type: string
        failure_message:
          type: string
        status:
          type: string
        createdAt:
          type: string
          format: date-time
        closedAt:
          type: string
          format: date-time
    model-payment-transaction-list:
      type: object
      properties:
        list:
          type: array
          items: 
            $ref: '#/definitions/model-payment-transaction'
    response-model-payment-transaction-list:
      allOf:
        - $ref: '#/definitions/response-base'
        - type: object
          properties:
            returnValue:
              $ref: '#/definitions/model-payment-transaction-list'
responses:
    response-internal-server-error-500:
      description: Internal Server error
      schema:
        $ref: '#/definitions/response-base'
    response-unauthorized:
        description: Authentication information is missing or invalid
        schema:
          $ref: '#/definitions/response-base' 
        headers:
          WWW_Authenticate:
            type: string